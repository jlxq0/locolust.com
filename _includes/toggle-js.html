<script>
  var themeToggleBtn = document.getElementById('theme-toggle');

  themeToggleBtn.addEventListener('click', function () {
    if (document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('color-theme', 'light');
      changeGiscusTheme('light');
    } else {
      document.documentElement.classList.add('dark');
      localStorage.setItem('color-theme', 'dark');
      changeGiscusTheme('dark');
    }
  });

  function toggleMenu() {
    var menu = document.getElementById("mainmenu");
    menu.classList.toggle("hidden");
  }

  // Flyout menu handling - enhances CSS hover with better UX
  (function() {
    var menuItems = document.querySelectorAll('[data-menu-item]');
    var closeTimeout;

    // Mark as JS-enhanced to disable CSS group-hover (optional refinement)
    menuItems.forEach(function(item) {
      item.classList.remove('group');
      item.classList.add('js-menu');
    });

    menuItems.forEach(function(item) {
      var dropdown = item.querySelector('[data-menu-dropdown]');
      if (!dropdown) return;

      function showDropdown() {
        clearTimeout(closeTimeout);
        // Hide all other dropdowns
        menuItems.forEach(function(other) {
          var otherDropdown = other.querySelector('[data-menu-dropdown]');
          if (otherDropdown && otherDropdown !== dropdown) {
            otherDropdown.classList.add('opacity-0', 'invisible');
            otherDropdown.classList.remove('opacity-100', 'visible');
          }
        });
        // Show this dropdown
        dropdown.classList.remove('opacity-0', 'invisible');
        dropdown.classList.add('opacity-100', 'visible');
      }

      function hideDropdown() {
        closeTimeout = setTimeout(function() {
          dropdown.classList.add('opacity-0', 'invisible');
          dropdown.classList.remove('opacity-100', 'visible');
        }, 150);
      }

      item.addEventListener('mouseenter', showDropdown);
      item.addEventListener('mouseleave', hideDropdown);

      // Keep dropdown open when hovering over it
      dropdown.addEventListener('mouseenter', function() {
        clearTimeout(closeTimeout);
      });
      dropdown.addEventListener('mouseleave', hideDropdown);
    });
  })();
</script>
